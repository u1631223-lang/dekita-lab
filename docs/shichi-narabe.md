# Shichi-narabe (Seven Sevens) Game Design

七並べ（しちならべ）は、ジョーカーを除いた 52 枚のトランプを使い、各マークの 7 を基準に数字をつないでいくシンプルかつ戦略的なゲームです。本ドキュメントでは、ゲームモジュール実装に必要な詳細仕様と運用メモをまとめます。

---

## 1. 使用カードと推奨プレイ人数

- 使用カード: ジョーカーを抜いた 52 枚のトランプ
- 推奨人数: 2〜6 人（4 人プレイがバランス推奨）

## 2. 準備手順

1. 52 枚のカードをよくシャッフルする
2. プレイヤーへ均等にカードを配る（例: 4 人なら 13 枚ずつ、5 人なら 10〜11 枚ずつ）
3. 配られたカードは各プレイヤーが手札として保持し、非公開情報とする

## 3. ゲーム開始シーケンス

- 各スート（♠ / ♥ / ♦ / ♣）の「7」が中央の場の基準カード
- スタート時に、該当する 7 を持っているプレイヤーは自動的に場へ出す
- これにより、最大 4 枚の「7」が初期状態で並ぶ

## 4. ターンとカードの出し方

- ターン順は時計回り
- 自分のターンに、場へ既に出ている同じスートのカードに隣接する数字を出せるならプレイする
  - 例: ♥7 が場にある場合、♥6 か ♥8 を出す
- 選択可能なカードは同じスートの「1 つ小さい」または「1 つ大きい」数字のみ

## 5. パスの取り扱い

- 出せるカードがない、または戦略的に出したくない場合は「パス」可能
- 標準ルールでは 1 ゲームで最大 3 回まで
- 3 回パスするとそのプレイヤーは脱落し、その後のターンを失います
- 教育向けバリアントではパス回数を無制限にする運用も可

## 6. 勝敗条件

- 最も早く手札をすべて出したプレイヤーが勝者
- 上がり以外のプレイヤーは残り手札枚数（または点数）で順位付けする

## 7. ゲーム終了条件

- 場に出せるカードが誰にも無く、全員が連続してパスした場合にラウンド終了
- 終了時点での出札数や残り手札で順位を確定する

## 8. 推奨スコアリング（連続プレイ向け）

| 順位 / 状況           | 点数  |
| --------------------- | ---- |
| 1 位（上がり）        | +10  |
| 2 位                  | +5   |
| 3 位                  | +2   |
| パス 3 回で脱落        | −5   |
| 最後まで残った（ビリ） | −10  |

## 9. バリアントルール（オプション）

- **ジョーカー使用**: 任意の数字の代用として使用。ただし 7 を跨ぐようには置けないなど制限を付ける
- **ブロック戦略**: 出せるカードを意図的に温存して相手をパスさせる駆け引きを許容
- **制限時間**: 1 ターンあたり 10 秒など時間制限を設定し、テンポを向上

## 10. 実装メモ

### カード状態の管理

| 状態名    | 定義                                      |
| --------- | ----------------------------------------- |
| `hidden`  | 手札に保持中                               |
| `field`   | 場に出ている                               |
| `passed`  | パス回数のトラッキング用フラグ（プレイヤー単位） |

### 出札可否判定ロジック（擬似コード）

```ts
function canPlay(card: Card, field: Record<Suit, SuitFieldState>) {
  const suitState = field[card.suit];
  const lowest = suitState.lowestNumber;
  const highest = suitState.highestNumber;
  return card.number === lowest - 1 || card.number === highest + 1;
}
```

`SuitFieldState` は各スートに対して、場に出ている最小値と最大値を追跡する構造体を想定します。

## 11. 教育効果

- 数字の前後関係と順序感覚の強化
- 戦略的判断と自制心のトレーニング（出す／出さない選択）
- 家族・保護者と協働することで心理的安全性を保った学習体験を提供

---

### 今後の実装タスク

- `front/src/modules/shichi-narabe/` 以下にゲームロジックと画面を実装
- `src/modules/registerModules.ts` で `createShichiNarabeModule` を登録
- ラウンド完了時は `recordRound` を呼び出し、セッションエンジン経由で `useProgressStore.addStars` をトリガーする
