# 技術スタック計画

目的リマインダー：すべての技術選定は、科学的根拠に基づいた楽しい学習ループを最優先にし、ミニゲームの高速改善と拡張性を担保するためのものとする。

## リポジトリ構造ガイド
- `front/` – フェーズ1の中心となるWebクライアント。タブレット・デスクトップで快適に動作するよう設計。
- `backend/` – 将来的な分析基盤や保護者向けポータルAPIのためのプレースホルダー（MVPでは空）。
- `docs/` – 設計資料や計画書を格納。
- `ops/` – デプロイ設定やCI/CDスクリプト（ホスティングフロー確定後に整備）。

## フロントエンド（フェーズ1の主対象）
- **フレームワーク**: React 18 + TypeScript（Viteベース）で素早い開発と型安全性を両立。
- **状態管理**: Zustandを用いてゲーム状態・適応メトリクス・報酬キューなどを明示的に管理。
- **描画レイヤー**: Reactコンポーネント上でCanvas描画（React Konvaもしくは自前フック）を活用し、メニュー等はDOMでアクセシビリティを確保。
- **スタイリング**: Tailwind CSS + CSS変数で、統一された余白/タイポグラフィを保ちながら素早くUIを試作。
- **国際化**: `react-i18next`で日本語・英語の切り替えと将来の多言語展開に備えた管理。
- **オーディオ管理**: `howler.js`により遅延の少ない効果音・ナレーション再生を実現。
- **テスト**: Vitest + React Testing LibraryでUI/状態の単体テスト、Playwrightで操作・アクセシビリティの回帰を確認。
- **ビルドターゲット**: `vite-plugin-pwa`を利用し、PWA対応とオフライン化の基礎を確立。

## 共通コアモジュール（`front/src/core`）
- `engine` – ゲームループ全体、セッション遷移、タイマーを制御するステートマシン。
- `adaptive` – 難易度調整ロジックやストリーク判定、エラーハンドリングの共通化。
- `rewards` – 音声・視覚演出・セリフを統合し、強化スケジュールを管理。
- `telemetry` – 指標の収集・平滑化・将来の送信フックを提供。
- `ui` – 大きなタッチターゲットを備えた共通UIパーツ。
- `state` – IndexedDB（`idb-keyval`）による永続化アダプタとZustandストア。

## ツールチェーン & 品質
- **パッケージ管理**: pnpm（バックエンド導入後のマルチパッケージにも対応）。
- **Lint/Format**: ESLint（typescript/react-hooks）、Stylelint、PrettierをHuskyプリコミットで強制。
- **Storybook**: UIコンポーネントやゲーム状態を共有し、デザイナー・教育監修との議論を円滑化。
- **解析スタブ**: TypeScript型でイベントスキーマを定義し、実送信は後続フェーズで実装する。

## インフラロードマップ
- **ホスティング（フェーズ1）**: Vercelを想定。プレビュー環境が自動で生成され、反復を加速。
- **CI**: GitHub Actionsでlint、単体テスト、Playwrightのスモークテストを実行。
- **フィーチャーフラグ**: Viteの環境変数ベースで簡易的に制御し、バックエンド導入まではクライアント内で完結。

## 将来のバックエンド（フェーズ2以降）
- **ランタイム**: Node.js（NestJSまたはFastify）による進捗収集APIや保護者ダッシュボードの基盤。
- **データベース**: Firebase/Firestore または Supabaseを候補に、迅速な認証とデータ管理を行う。
- **認証**: マジックリンクや保護者向けOAuthを検討し、子どものプライバシーを守る設計とする。

技術選択は常に「科学的な遊びの価値提供」を最優先に、目的から逸れた複雑化を避ける。

