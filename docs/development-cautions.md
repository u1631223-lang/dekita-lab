# 開発上の注意点

目的リマインダー：ここで挙げる注意事項は、子どもが飽きずに科学的な「できた！」体験を積み重ねられるよう、実装時に守るべきガードレールです。

## 多感覚演出に関する留意点
- 成功演出は 0.5 秒以内に発火させるが、連続発火時は 3 秒以上のクールダウンを設け過剰刺激を防ぐ。
- 効果音は 75dB 相当を超えないようミキシングし、保護者設定で音量オフ／軽減を提供する。
- 失敗時は落ち着いた色・音（短い和音、暖色系フェード）を用いて再挑戦意欲を削がない。

## ランダム性と学習効果
- 完全ランダムではなく「制御付きランダム性」を採用し、種（seed）とカテゴリ重みを明示的に管理する。
- 同一刺激が連続3回以上出現しないようガードを書く際、パフォーマンス劣化がないかベンチマークする。
- ランダム生成ロジックはユニットテストで再現性を担保し、更新時にスナップショットが変わる場合は理由をドキュメントへ追記。

## アクセシビリティ & 計測
- 色覚多様性を想定し、UIの主要情報は色＋形＋テキストで伝える。
- アニメーションの秒数や移動量はモーション酔いを避ける範囲（300–500ms、移動距離は画面幅の20%以内）に収める。
- テレメトリには成功率・反応時間に加え、ヒント発火回数・演出の多様性指数を記録し、継続率向上施策に活用する。

## デザイン変更時のプロセス
- 演出アセット（音・アニメーション）を追加／差し替える際は、`docs/experience-design.md` のサプライズカタログ条件を更新。
- ランダム性調整や閾値変更は必ず `adaptive` 配下の設定ファイルと関連テストを同時に修正。
- 大幅なUI変更を行う場合は、保護者向けUXへの影響をチケットメモに記載し、関係者レビューを経てからマージする。

これらの注意点は、実装フェーズでのぶれを防ぎ、学習科学に基づいた体験を継続的に提供するための最低限のチェックリストとして活用してください。


## Serena ツール活用メモ
- コード調査は `serena find_symbol` や `serena search_for_pattern` をまず利用し、不要なファイル読み込みを避けてコンテキストを節約する。
- 新規コンポーネントやロジック確認時は `serena get_symbols_overview` で構造を把握し、必要部分のみ開く。
- チケット更新時は、参照したコマンドを `docs/troubleshooting-log.md` またはチケットメモに記載してナレッジ共有する。
- 大量の出力が想定される場合は、検索範囲（relative_path や glob）を絞って出力を最小限に保つ。

## 保護者ゲート運用
- 設定系の操作（報酬設定など）は `CaregiverGateModal` を通して確認し、子どもの誤操作を防ぐ。
- ゲート問題は随時ランダムに生成されるため、再利用時はモーダルを再マウントしてリセットすること。
- 既存コンポーネントに新しい保護者ロックを追加する場合、アクセシビリティ上 `role="dialog"` とフォーカス制御を忘れない。
