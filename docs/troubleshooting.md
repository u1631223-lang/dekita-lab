# トラブルシュートガイド

目的リマインダー：エラー発生時に迅速かつ科学的な学習体験を損なわないよう、原因特定と復旧を標準化する。

## 1. 初動チェックリスト
1. 画面上のエラーメッセージを記録（スクリーンショット、文言）。
2. ブラウザコンソール・ネットワークログを開き、エラーコードやスタックトレースをコピー。
3. 最新の実行タスク（チケットID）とエラー発生タイミングを `docs/tickets.md` のメモ欄に即時記録。

## 2. Serena ツール活用手順
- `serena` 経由で次のコマンドを実行し、エラー原因を検索：
  - `serena find_symbol` ：該当関数・コンポーネントの定義を特定。
  - `serena search_for_pattern` ：エラー文言やログキーでコード全体を検索。
  - `serena get_symbols_overview` ：新規ファイルの構造を把握し影響範囲を確認。
- エラー調査のたびに結果を `docs/troubleshooting-log.md`（後述）へ追記。

## 3. よくある問題と対処
### ビルド/型エラー
- `pnpm run lint` / `pnpm build` のログを確認し、型定義やESLintルール違反を修正。
- エンジンやモジュール間の契約ズレが疑われる場合、`front/src/core/engine` と該当モジュールのインターフェースを照合。

### PWA/オフライン関連
- サービスワーカーキャッシュが古い可能性があるため、ブラウザで「更新＋キャッシュ削除」を実行。
- `serena find_referencing_symbols` でキャッシュキー定義箇所を特定し、バージョン番号の更新漏れを確認。

### 演出・ランダム性の不具合
- `docs/experience-design.md` と `docs/development-cautions.md` の条件に合致しているかをチェック。
- ランダム性の再現手順を記すため、疑似乱数シードを固定 (`ADP-04`) して再現性を確保。

## 4. ログ管理
- エラー調査を行ったら `docs/troubleshooting-log.md` に以下を追記：
  - 事象日時／担当／チケットID
  - エラー概要とスクリーンショットリンク
  - Serena で実行したコマンドと主要な出力要約
  - 解決策とフォローアップ（再発防止策、ドキュメント修正など）

## 5. 再発防止とレビュー
- 修正完了後は必ず関連テスト（ユニット・Playwright）を実行し、結果をチケットに記録。
- エラー調査で得た知見は、必要に応じて `docs/experience-design.md` や `docs/development-cautions.md` に反映。
- 定期的にSerenaのプロジェクトメモリを見直し、コマンドや手順の最新化を図る。

このガイドはエラー対応時に必ず参照し、Serenaの機能を活用して迅速な原因特定とナレッジ蓄積を徹底すること。

