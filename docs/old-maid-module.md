# ãƒãƒæŠœãï¼ˆOld Maidï¼‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè£…ãƒ¡ãƒ¢

## ç›®çš„
- ãƒˆãƒ©ãƒ³ãƒ— 52 æš + ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ 1 æšã§é€²è¡Œã™ã‚‹å¿ƒç†æˆ¦è¦ç´ ä»˜ãã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã‚’å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸è¿½åŠ ã—ã€ã€Œè¡¨æƒ…ã‚’èª­ã‚€ã€ã€Œæ‰‹æœ­ç®¡ç†ã€ã€Œé§†ã‘å¼•ãã€ã®ç·´ç¿’æ©Ÿä¼šã‚’æä¾›ã™ã‚‹ã€‚
- æ—¢å­˜ã® `GameModule` å¥‘ç´„ã«å¾“ã„ã€ãƒ©ã‚¦ãƒ³ãƒ‰åˆ¶ãƒ»é›£æ˜“åº¦åˆ¶å¾¡ãƒ»å ±é…¬æ¼”å‡ºã‚’çµ±åˆã™ã‚‹ã€‚

## ä½¿ç”¨ã‚«ãƒ¼ãƒ‰
- 13 ãƒ©ãƒ³ã‚¯ Ã— 4 ã‚¹ãƒ¼ãƒˆ + Jokerï¼ˆ`rank: 'JOKER'`ï¼‰ã€‚
- UI è¡¨ç¤ºã¯ `"A".."K"` ã®è‹±å­—è¡¨è¨˜ï¼‹ suit çµµæ–‡å­—ã€Joker ã¯ ğŸƒã€‚
- `OldMaidCard` å‹
  ```ts
  type OldMaidCard = {
    id: string; // ä¾‹: "H-7", "JOKER"
    suit: 'â™ ' | 'â™¥' | 'â™¦' | 'â™£' | 'JOKER';
    rank: 'A' | '2' | ... | 'K' | 'JOKER';
    isJoker: boolean;
  };
  ```

## åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼
1. `createDeck(randomizer)` ã§ã‚«ãƒ¼ãƒ‰ã‚’ãƒ•ã‚§ã‚¢ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã€‚
2. `dealHands(deck, totalPlayers)` ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸å‡ç­‰é…å¸ƒï¼ˆä½™ã‚Š 1 æšã¯æœ€å¾Œã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ï¼‰ã€‚
3. å„æ‰‹æœ­ã‹ã‚‰åŒãƒ©ãƒ³ã‚¯ 2 æšã‚’ `stripPairs(hand)` ã§é™¤å»ã—ã€`discardedPairs` ã‚«ã‚¦ãƒ³ã‚¿ã¸åŠ ç®—ã€‚
4. ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹æ™‚ã« `OldMaidRoundState` ã‚’æ§‹ç¯‰ã€‚
   ```ts
   type OldMaidRoundState = {
     players: OldMaidPlayerState[]; // ãƒ†ãƒ¼ãƒ–ãƒ«é †
     turnIndex: number;             // ç¾åœ¨ã‚¿ãƒ¼ãƒ³
     jokerHolderId: string | null;  // UI å¼·èª¿ç”¨
     discardedPairs: number;
     config: OldMaidConfig;
   };
   ```

## ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å®šç¾©
- `OldMaidPlayerState`
  ```ts
  type OldMaidPlayerState = {
    id: string;             // "player", "ai-1"â€¦
    displayNameKey: string; // i18n ã‚­ãƒ¼
    isHuman: boolean;
    hand: OldMaidCard[];
    status: 'playing' | 'finished';
  };
  ```
- æ•µ AI ã¯ 2ã€œ3 åã€‚ã‚¿ãƒ¼ãƒ³å‡¦ç†ã¯ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆã¨ã¯åˆ¥ã« UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ã§é€²è¡Œã•ã›ã‚‹ã€‚

## ã‚¿ãƒ¼ãƒ³é€²è¡Œãƒ­ã‚¸ãƒƒã‚¯
- `turnIndex` ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ `nextIndex = findNextActive(players, turnIndex)` ã®æ‰‹æœ­ã‹ã‚‰ 1 æšå¼•ãã€‚
- å¼•ã„ãŸã‚«ãƒ¼ãƒ‰ã‚’è‡ªåˆ†ã®æ‰‹æœ­ã¸è¿½åŠ  â†’ `stripPairs` ã§åŒãƒ©ãƒ³ã‚¯ã‚’å³é™¤å»ã€‚
- æ‰‹æœ­ãŒ 0 æšã«ãªã£ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ `status: 'finished'` ã«è¨­å®šã—ã€ä»¥é™ã‚¹ã‚­ãƒƒãƒ—ã€‚
- Joker ã‚’å«ã‚€æ‰‹æœ­ãŒè‡ªåˆ†ã®ã¿ã«ãªã£ãŸæ™‚ç‚¹ã§ã‚²ãƒ¼ãƒ çµ‚äº†ã€‚`success` åˆ¤å®šã¯äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒãƒã‚’å›é¿ã§ããŸã‹ã§æ±ºå®šã€‚

## é›£æ˜“åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
| Difficulty | AI äººæ•° | Joker ãƒ’ãƒ³ãƒˆ | AI é¸æŠã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | é–‹å§‹ãƒ¡ãƒ¢ |
|------------|---------|---------------|----------------------|----------|
| `lv1`      | 2 å    | Joker ã‚’ä¿æŒã—ã¦ã„ã‚‹ AI ã®ã‚«ãƒ¼ãƒ‰æŸã‚’ 1.6 ç§’ç‚¹æ»… | å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ  | å…ç«¥å‘ã‘å°å…¥ |
| `lv2`      | 2 å    | å‰ 3 ã‚¿ãƒ¼ãƒ³ã®ãƒ’ãƒ³ãƒˆå±¥æ­´ã‚’ã‚‚ã¨ã« 1 å›ã®ã¿å¼·èª¿ | Joker ã‚’é¿ã‘ã‚‹ç¢ºç‡ 60% | ä¸­æ ¸é›£åº¦ |
| `lv3`      | 3 å    | ãƒ’ãƒ³ãƒˆãªã— | Joker ã‚’é¿ã‘ã‚‹ç¢ºç‡ 80%ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒšã‚¢æƒ…å ±ã‚’å‚ç…§ | ãƒãƒ£ãƒ¬ãƒ³ã‚¸ |

`OldMaidConfig` ã§ `aiPlayers`, `maxHints`, `aiDelayMs`, `jokerAvoidance` ã‚’æŒ‡å®šã€‚`ControlledRandomizer` ã‚’æ¸¡ã—ã¦ deck shuffle ã®å†ç¾æ€§ã‚’æ‹…ä¿ã—ã€AI ã®æ‰‹æœ­é¸æŠã¯ UI å´ã® `Math.random` ã§ååˆ†ï¼ˆæ¼”å‡ºé‡è¦–ï¼‰ã€‚

## UI & çŠ¶æ…‹é·ç§»
1. `waiting`: ã‚¿ãƒ¼ãƒ³é–‹å§‹ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã€‚AI ã®æ‰‹æœ­ã¯è£é¢ã§æ‰‡å½¢è¡¨ç¤ºã€‚
2. `selecting`: äººé–“ã‚¿ãƒ¼ãƒ³ã€‚å·¦éš£ï¼ˆ`nextIndex`ï¼‰ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ 1 æšã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§å¼•ãæŠœãã€‚
3. `checking`: `stripPairs` ã®çµæœã«å¿œã˜ã¦
   - ãƒšã‚¢æˆç«‹ â†’ ã‚«ãƒ¼ãƒ‰ãŒæ˜Ÿå±‘ã¸å¤‰åŒ–ã— `addStars` ãƒˆãƒªã‚¬ãƒ¼ã¯ `recordRound(true)` æ™‚ã«å®Ÿè¡Œã€‚
   - Joker ã‚’å—ã‘å–ã£ãŸå ´åˆã¯ã‚«ãƒ¼ãƒ‰ãŒèµ¤ãç™ºå…‰ã™ã‚‹ã€‚
4. `result`: å‹æ•—ç¢ºå®šå¾Œã« `recordRound` ã¸çµæœé€ä¿¡ã€‚`reactionTimeMs` ã¯ã‚¿ãƒ¼ãƒ³é–‹å§‹ã‹ã‚‰å‹æ•—åˆ¤å®šã¾ã§ã®çµŒéæ™‚é–“ã‚’æ¸¬å®šã€‚`hintsUsed` ã¯ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³åˆ©ç”¨å›æ•°ã€‚

UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `OldMaidScreen.tsx` + `OldMaidScreen.css`
- `useSessionController` ã‹ã‚‰ `roundState` ã‚’å—ã‘å–ã‚Šã€`useState` ã§ãƒ­ãƒ¼ã‚«ãƒ«é€²è¡Œã€‚
- `useAudioCue` ã§ `pair` / `joker` / `success` ã‚·ã‚°ãƒŠãƒ«ã‚’å†ç”Ÿã€‚
- `useEffect` ã§ AI ã‚¿ãƒ¼ãƒ³ã‚’ `setTimeout` å®Ÿè¡Œã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‹åˆ©æ™‚ã¯å‹åˆ©æ¼”å‡º â†’ æ¬¡ãƒ©ã‚¦ãƒ³ãƒ‰é·ç§»ã€‚

## ãƒ†ãƒ¬ãƒ¡ãƒˆãƒª & å ±é…¬
- `recordRound` ã«æ¸¡ã™ `RoundResult`:
  - `success`: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ Joker ã‚’æ‰‹æ”¾ã—ãŸæ™‚ç‚¹ã§ `true`ã€‚
  - `reactionTimeMs`: ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹ã‹ã‚‰æ±ºç€ã¾ã§ã€‚
  - `hintsUsed`: ãƒ’ãƒ³ãƒˆåˆ©ç”¨æ•°ã€‚
- æˆåŠŸæ™‚ `useProgressStore.addStars` ãŒå‘¼ã°ã‚Œã‚‹ï¼ˆSessionProvider ãŒè‡ªå‹•åŠ ç®—ï¼‰ã€‚ãƒ’ãƒ³ãƒˆæœªä½¿ç”¨ãªã‚‰ +1 ãƒœãƒ¼ãƒŠã‚¹ã¯æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã«æº–æ‹ ã€‚

## ç¿»è¨³ã‚­ãƒ¼
- `hub.oldMaid`ï¼ˆãƒãƒ–è¡¨ç¤ºåï¼‰
- `oldMaid.goal`, `oldMaid.hint`, `oldMaid.jokerWarning`, `oldMaid.victory`, `oldMaid.defeat`, `oldMaid.turn`, `oldMaid.resultMessage`
- AI ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åå‰: `oldMaid.ai.sunny`, `oldMaid.ai.moon`, `oldMaid.ai.comet`

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
front/src/modules/old-maid/
â”œâ”€â”€ module.ts              // GameModule å®Ÿè£…
â”œâ”€â”€ types.ts               // å‹å®šç¾©
â”œâ”€â”€ config.ts              // é›£æ˜“åº¦ãƒãƒƒãƒ— & åˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ logic.ts               // ãƒšã‚¢åˆ¤å®šãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ OldMaidScreen.tsx      // UI æœ¬ä½“
â”œâ”€â”€ OldMaidScreen.css      // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ & æ¼”å‡º
â””â”€â”€ module.test.ts         // createRound ã® deterministic ãƒ†ã‚¹ãƒˆ
```

## è¿½åŠ å¯¾å¿œ
- `GameId` å‹ã¸ `'old-maid'` ã‚’è¿½åŠ ã€‚
- `registerModules`, `AppRouter`, `SessionProvider` ã®ãƒ™ãƒ¼ã‚¹é›£æ˜“åº¦ãƒãƒƒãƒ—æ›´æ–°ã€‚
- i18n ãƒªã‚½ãƒ¼ã‚¹ã«ç¿»è¨³ã‚­ãƒ¼ã‚’è¿½åŠ ï¼ˆæ—¥æœ¬èª/è‹±èªï¼‰ã€‚
- `docs/tickets.md` ã«ãƒã‚±ãƒƒãƒˆã‚’è¿½åŠ ã—ã€å®Œäº†å¾Œ `DONE` ã¸æ›´æ–°ã€‚
