# 神経衰弱（Concentration）ゲーム仕様

最終更新: 2025-10-29

## 1. 概要
- **目的**: 記憶力・集中力・空間認識を伸ばすカードペア探しゲーム。
- **対象年齢**: 幼児〜大人。カード枚数と裏返し時間で難易度調整。
- **ゲームID**: `concentration`（フロントエンド実装用）。

## 2. 使用カード
- 基本はジョーカーを除く 52 枚のトランプを使用（13 ランク × 4 スート）。
- 幼児向けはランクを 1〜7 に絞った 28 枚（14 ペア）など、モジュール設定でサブセットを選択可能。
- カード表現
  - `rank`: `A`〜`K` または `1`〜`10`
  - `suit`: `hearts`, `diamonds`, `clubs`, `spades`
  - `color`: `red`（♥♦） / `black`（♣♠）

## 3. セットアップ
1. 難易度設定に応じたデッキを構築し、ランダムシャッフル。
2. カードは裏向きグリッドに配置。レイアウトは `rows × columns` を難易度ごとに固定。
3. プレイヤーは 1〜2 人。MVP ではシングルプレイ＋スコア集計で実装。

## 4. ゲーム進行
1. アクティブプレイヤーが 2 枚のカードを選択して表向きにする。
2. ランク一致、スート一致などのマッチング条件を難易度に応じて判定。
3. 成功時:
   - ペア確定カードを盤面から除外。
   - 取得ペア数を更新し、連続ターン権を付与。
4. 失敗時:
   - 指定秒数経過後にカードを自動的に裏返す。
   - ターンを次プレイヤーへ移す（MVP では内部的にリセットのみ）。

## 5. 勝利条件 & スコア
- 盤面のペアがすべて獲得されたらラウンド終了。
- 取得ペア数が最大のプレイヤーが勝利。MVP シングルプレイでは全ペア取得で成功。
- 同点時は引き分け。将来的なローカルルールとして「最後にペアを取った方を勝利」とするオプションを設ける。

## 6. 難易度設計

| 難易度 | カード数 | ペア数 | グリッド | 裏返しまで | マッチ条件 |
| --- | --- | --- | --- | --- | --- |
| 初級 | 12 枚 | 6 ペア | 3×4 | 3 秒 | ランク一致 |
| 中級 | 24 枚 | 12 ペア | 4×6 | 2 秒 | ランク一致 |
| 上級 | 52 枚 | 26 ペア | 4×13 | 1 秒 | ランク一致（将来: スート一致オプション） |

- `rankPool`: 利用するランク集合（例: `['A','2','3','4','5','6','7']`）。
- `hideDelayMs`: 失敗時にカードを自動で裏返すまでの時間。
- 追加パラメータ案: `allowHintReveal`, `maxMistakes`, `timeAttackSeconds`。

## 7. 拡張ルール（将来対応）
- **マーク一致ルール**: ペア判定をスート一致へ切り替える。
- **同色ルール**: 赤と黒を同一ペアとみなす。
- **タイムアタック**: 制限時間内にペア獲得数を競う。
- **スコア加算式**: 正解 +10、ミス -2、連続正解ボーナス。
- **対戦モード**: プレイヤー交互にターンを進め、勝敗を明確化。

## 8. 実装メモ
- **状態管理**: `hidden` / `peek` / `matched` の 3 状態を持つカードリスト。
- **非同期制御**: 2 枚のカードオープン後、`hideDelayMs` 経過で自動的に裏返し。
- **アクセシビリティ**: カードにはランク・スート・色名を aria-label で付与。
- **演出**: マッチ成功時はキラキラ演出＋効果音、不一致時は軽い揺れアニメ。
- **進捗表示**: 残りペア数、取得ペア数、経過時間（タイマー）を HUD に表示。
- **リスタート**: クリア時またはメニュー操作で再シャッフルし、新しいラウンドを開始。

## 9. 教育的狙い
- 記憶力・集中力・空間認識力の向上。
- 「同じ」「違う」の概念理解を促進。
- 数字・マークへの親しみとカード読み上げ練習。
- 負けたときの感情コントロールやターン待機の社会的学習。

## 10. 画面構成（MVP）
1. **グリッド領域**: カード 12〜52 枚をレスポンシブに表示。小さな端末では 2 カラムから自動調整。
2. **HUD**: 成功率・ミス回数・残りペア数を `GameHud` + サブパネルで表示。
3. **アクションバー**: ヒントボタン（ヒントを使うと reveal 全体公開）、終了ボタン。
4. **演出層**: `RewardToast` ＋ `CelebrationOverlay` を既存実装に合わせて利用。

## 11. テスト観点
- デッキ生成が常に偶数枚・ペアが揃うこと。
- 難易度ごとのカード構成・グリッド設定が仕様通り。
- カード選択 → 自動裏返しのタイミングが `hideDelayMs` に追従する。
- 全カード一致でセッション成功、ミス上限で失敗（将来的な制約）。
